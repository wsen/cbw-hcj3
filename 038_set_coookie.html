<!DOCTYPE html>
<html>
	<head>
		<title>038 set cookie</title>
		<meta charset="utf-8" />
		<link href="./styles/global_style.css" type="text/css" rel="stylesheet" media="screen" />
		<script src="../script/jquery-3.3.1.min.js"></script>
		<style>
			noscript {
                color: red;
                border: 2px dotted red;
            }
		
		</style>
	</head>
	
	<body>
        <h1>038 set cookie</h1>
        <noscript>Sie haben JavaScript in Ihrem Webbrowser abgeschalkt.</noscript>
        
		<!-- <h2>zweite &Uuml;berschrift der Seite</h2> -->
        Cookie Name: <input type="text" id="cookieName" value="" required="required" />
        Cookie Wert: <input type="text" id="myInput" value="" required="required"/>
		<!-- <p>Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.</p> -->
        
        <button id="hallo">Hallo</button>

        <script>
            window.onunload = tschuess;
            window.onload = hallo;
            

            $("#myInput").blur(function(evt) {
                if($("#cookieName").val() != "" && $(this).val() != "") {
                    cookieSchreiben($("#cookieName").val(), $(this).val(), 1);
                } else {
                    alert("totaler Bockmist!");
                }          
            });
             
            // window.onload = 
            // setting the cookie value
			function cookieSchreiben(cookieName, cookieValue, expirationDays) {
				var expirationDate = new Date();
				expirationDate.setDate(expirationDate.getDate() + expirationDays);
				
				cookieValue = cookieValue + "; expires=" + expirationDate.toUTCString();
				document.cookie = cookieName + "=" + cookieValue;
			}
                      
            // alert(""jetzt/(1000 * 3600 * 24 * 365));

            function tschuess() {
                var heute = new Date();
                var jetzt = heute.getTime();
				cookieSchreiben("zuletztHier", jetzt, 365);
			}

            function hallo() {
                var heute = new Date();
                var jetzt = heute.getTime();
				var cookieArr = document.cookie.split(";");
				var ausgabe = "";

				for (var i = 0; i < cookieArr.length; i++) {
					var cookie = cookieArr[i];
					var index = cookie.indexOf("=");
					var key = cookie.substr(0, index);
					var val = cookie.substr(index + 1);
                    if(key=="zuletztHier") {
                        break;
                    }
					//ausgabe += key + " - " + val + "<br />";
				}
                var zeitVerg = jetzt - val;
                switch(zeitVerg) {
                    case (zeitVerg<1000):
                        alert("set dem letzten Buch sind: " + zeitVerg/1000 + " Sekunden vergangen");
                        break;
                    case (zeitVerg<60000):
                        alert("set dem letzten Buc  h sind: " + zeitVerg/1000 + " Sekunden vergangen");
                        break;
                    case (zeitVerg<60000 * 60):
                        var anzeige = Math.round(zeitVerg/60000);
                        anzeige = "set dem letzten Buch sind: " + anzeige + " Minuten vergangen";
                        break;
                    case (zeitVerg<60000 * 60 *60):
                        var anzeige = Math.round(zeitVerg/60000);
                        anzeige = "set dem letzten Buch sind: " + anzeige + " Sekunden vergangen";
                        break;
                    default:
                        alert("your first visit!");
                        break;
                }

				//$("#ausgabe").html(ausgabe);
							//cookieSchreiben("zuletztHier", jetzt, 365);

                //window.onload = hallo; 
                $("hallo").click(hallo);
                window.onunload = tschuess;
			}
        </script>
                      
    </body>
</html>